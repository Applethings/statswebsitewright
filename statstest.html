<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Statistics FRQ Test</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('images/bgg.gif') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .content {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 40px;
            margin: 40px;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .navigation {
            position: fixed;
            bottom: 20px;
            display: flex;
            gap: 20px;
            background-color: rgba(0, 0, 32, 0.4);
            padding: 10px 20px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
        }
        .nav-button {
            background-color: rgba(0, 0, 128, 0.3);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .nav-button:hover {
            background-color: rgba(0, 0, 128, 0.5);
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 128, 0.6);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .back-button:hover {
            background-color: rgba(0, 0, 128, 0.8);
        }
        h1, h2, h3 {
            text-align: center;
            margin-bottom: 10px;
        }
        .page-number {
            color: white;
            margin: 0 20px;
        }
        .image-container {
            text-align: center;
            margin: 20px 0;
        }
        .image-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
        }
        .directions {
            margin-bottom: 30px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
        }
        .question {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .answer-space {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            min-height: 120px;
            margin: 15px 0;
            padding: 10px;
            width: 100%;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
        }
        .answer-space:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background-color: rgba(255, 255, 255, 0.15);
        }
        .download-button {
            background-color: rgba(0, 0, 128, 0.5);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
        }
        .download-button:hover {
            background-color: rgba(0, 0, 128, 0.8);
        }
        .submit-button {
            display: block;
            width: 200px;
            background-color: rgba(0, 128, 0, 0.6);
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            margin: 30px auto;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }
        .submit-button:hover {
            background-color: rgba(0, 128, 0, 0.8);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
        }
        .modal-content {
            background-color: rgba(0, 0, 32, 0.95);
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            color: white;
        }
        .modal-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }
        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: rgba(0, 0, 128, 0.5);
            color: white;
            transition: background-color 0.3s;
        }
        .modal-button:hover {
            background-color: rgba(0, 0, 128, 0.8);
        }
    </style>
</head>
<body>
    <a href="stats.html" class="back-button">Back</a>
    
    <div class="content">
        <div class="page active" id="page1">
            <h1>STATISTICS</h1>
            <h2>SECTION II</h2>
            <h3>Total Time—1 hour and 30 minutes</h3>
            <h3>6 Questions</h3>
            
            <div class="section-info">
                <h3>SECTION II, Part A</h3>
                <h3>Suggested Time—1 hour and 5 minutes</h3>
                <h3>5 Questions</h3>
            </div>
            
            <div class="directions">
                <strong>Directions:</strong> Show all your work. Indicate clearly the methods you use, because you will be scored on the correctness of your methods as well as on the accuracy and completeness of your results and explanations.
            </div>
        </div>
        
        <div class="page" id="page2">
            <h2>Question 1</h2>
            <div class="question-text">
                <p>1. A large exercise center has several thousand members from age 18 to 55 years and several thousand members age 56 and older. The manager of the center is considering offering online fitness classes. The manager is investigating whether members' opinions of taking online fitness classes differ by age. The manager selected a random sample of 170 exercise center members ages 18 to 55 years and a second random sample of 230 exercise center members ages 56 years and older. Each sampled member was asked whether they would be interested in taking online fitness classes.</p>
                <p>The manager found that 51 of the 170 sampled members ages 18 to 55 years and that 79 of the 230 sampled members ages 56 years and older said they would be interested in taking online fitness classes.</p>
                <p>At a significance level of α = 0.05, do the data provide convincing statistical evidence of a difference in the proportion of all exercise center members ages 18 to 55 years who would be interested in taking online fitness classes and the proportion of all exercise center members ages 56 years and older who would be interested in taking online fitness classes? Complete the appropriate inference procedure to justify your response.</p>
            </div>
            <textarea class="answer-space" placeholder="Enter your answer here..." data-question="1"></textarea>
        </div>
        
        <div class="page" id="page3">
            <h2>Question 2</h2>
            <div class="question-text">
                <p>2. A local elementary school decided to sell bottles printed with the school district's logo as a fund-raiser. The students in the elementary school were asked to sell bottles in three different sizes (small, medium, and large). The relative frequencies of the number of bottles sold for each size by the elementary school were 0.5 for small bottles, 0.3 for medium bottles, and 0.2 for large bottles.</p>
                <p>A local middle school also decided to sell bottles as a fund-raiser, using the same three sizes (small, medium, and large). The middle school students sold three times the number of bottles that the elementary school students sold. For the middle school students, the proportion of bottles sold was equal for all three sizes.</p>
                <p>(a) Complete the segmented bar graphs representing the relative frequencies of the number of bottles sold for each size by students at each school.</p>
                
                <div class="image-container">
                    <img src="images/image15.png" alt="Segmented Bar Graph for Elementary and Middle Schools" id="bar_graphs">
                </div>
                
                <p>(b) An administrator at the elementary school concluded that the elementary school students sold more small bottles than the middle school students did. Is the elementary school administrator's conclusion correct? Explain your response.</p>
                <textarea class="answer-space" placeholder="Enter your answer for part (b) here..." data-question="2b"></textarea>
                
                <p>Two high schools are also selling the bottles and are competing to see which one sold more large bottles.</p>
                <p>(c) A mosaic plot for the distribution of the number of bottles sold by each of the high schools is shown here.</p>
                
                <div class="image-container">
                    <img src="images/image16.png" alt="Mosaic Plot for High Schools" id="high_school_plot">
                </div>
                
                <p>(i) Which of the two high schools sold a greater proportion of large bottles? Justify your answer.</p>
                <textarea class="answer-space" placeholder="Enter your answer for part (c)(i) here..." data-question="2ci"></textarea>
                
                <p>(ii) Which of the two high schools sold a greater number of large bottles? Justify your answer.</p>
                <textarea class="answer-space" placeholder="Enter your answer for part (c)(ii) here..." data-question="2cii"></textarea>
            </div>
        </div>
        
        <div class="page" id="page4">
            <h2>Question 3</h2>
            <div class="question-text">
                <p>AP Statistics FRQ Question 3 content will go here.</p>
            </div>
            <textarea class="answer-space" placeholder="Enter your answer here..." data-question="3"></textarea>
        </div>
        
        <div class="page" id="page5">
            <h2>Question 4</h2>
            <div class="question-text">
                <p>AP Statistics FRQ Question 4 content will go here.</p>
            </div>
            <textarea class="answer-space" placeholder="Enter your answer here..." data-question="4"></textarea>
        </div>
        
        <div class="page" id="page6">
            <h2>Question 5</h2>
            <div class="question-text">
                <p>AP Statistics FRQ Question 5 content will go here.</p>
            </div>
            <textarea class="answer-space" placeholder="Enter your answer here..." data-question="5"></textarea>
        </div>
        
        <div class="page" id="page7">
            <h2>Question 6</h2>
            <div class="question-text">
                <p>AP Statistics FRQ Question 6 content will go here.</p>
            </div>
            <textarea class="answer-space" placeholder="Enter your answer here..." data-question="6"></textarea>
        </div>
    </div>
    
    <div class="navigation">
        <button class="nav-button" id="prevBtn">Previous</button>
        <span class="page-number" id="pageNumber">Page 1 of 7</span>
        <button class="nav-button" id="nextBtn">Next</button>
        <button class="nav-button" id="submitBtn" style="background-color: #004d00;">Submit Test</button>
    </div>
    
    <!-- Submission Modal -->
    <div id="submissionModal" class="modal">
        <div class="modal-content">
            <h3>Submit Your Test</h3>
            <p>Please enter your name or choose to submit anonymously:</p>
            <input type="text" id="submitterName" placeholder="Your Name" class="modal-input">
            <div class="modal-buttons">
                <button id="submitAnonymous" class="modal-button">Submit Anonymously</button>
                <button id="submitWithName" class="modal-button">Submit with Name</button>
                <button id="cancelSubmit" class="modal-button">Cancel</button>
            </div>
        </div>
    </div>
    
    <script>
        // Page Navigation
        let currentPage = 1;
        const totalPages = 7;
        
        function updatePageNumber() {
            document.getElementById('pageNumber').textContent = `Page ${currentPage} of ${totalPages}`;
        }
        
        function showPage(pageNum) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`page${pageNum}`).classList.add('active');
            currentPage = pageNum;
            updatePageNumber();
        }
        
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                showPage(currentPage - 1);
            }
        });
        
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentPage < totalPages) {
                showPage(currentPage + 1);
            }
        });
        
        // Store answers as they're typed
        const textareas = document.querySelectorAll('textarea');
        const answers = {};
        
        textareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                const questionNumber = this.getAttribute('data-question');
                answers[questionNumber] = this.value;
                
                // Save to localStorage
                localStorage.setItem('statsAnswers', JSON.stringify(answers));
            });
        });
        
        // Load saved answers if they exist
        window.addEventListener('load', () => {
            const savedAnswers = localStorage.getItem('statsAnswers');
            if (savedAnswers) {
                const answerObj = JSON.parse(savedAnswers);
                textareas.forEach(textarea => {
                    const questionNumber = textarea.getAttribute('data-question');
                    if (answerObj[questionNumber]) {
                        textarea.value = answerObj[questionNumber];
                        answers[questionNumber] = answerObj[questionNumber];
                    }
                });
            }
        });
        
        // Add submission handling
        const submissionModal = document.getElementById('submissionModal');
        const submitBtn = document.getElementById('submitBtn');
        const submitAnonymous = document.getElementById('submitAnonymous');
        const submitWithName = document.getElementById('submitWithName');
        const cancelSubmit = document.getElementById('cancelSubmit');
        const submitterName = document.getElementById('submitterName');

        submitBtn.addEventListener('click', () => {
            submissionModal.style.display = 'block';
        });

        cancelSubmit.addEventListener('click', () => {
            submissionModal.style.display = 'none';
        });
        
        submitAnonymous.addEventListener('click', () => {
            submitTest(true);
        });
        
        submitWithName.addEventListener('click', () => {
            const name = document.getElementById('submitterName').value.trim();
            if (!name) {
                alert('Please enter your name or choose to submit anonymously.');
                return;
            }
            submitTest(false, name);
        });
        
        // Function to handle test submission
        async function submitTest(isAnonymous = false, providedName = null) {
            // Use the provided name if available, otherwise get it from the submitterName field
            let userName = isAnonymous ? "Anonymous Student" : (providedName || document.getElementById('submitterName').value.trim());
            
            if (!isAnonymous && (!userName || userName.length < 2)) {
                alert("Please enter your name or choose to submit anonymously.");
                return;
            }
            
            // Show loading state
            const submitButton = document.querySelector('#submitWithName');
            const anonymousButton = document.querySelector('#submitAnonymous');
            submitButton.disabled = true;
            anonymousButton.disabled = true;
            submitButton.textContent = 'Submitting...';
            
            try {
                // Create submission object
                const submission = {
                    name: userName,
                    testId: 'statstest',
                    testType: 'FRQ',
                    timestamp: new Date().toISOString(),
                    answers: answers
                };
                
                // Prompt for GitHub token instead of hardcoding it
                const githubToken = prompt("Please enter the GitHub token to submit your test:", "");
                
                // Check if token was provided
                if (!githubToken) {
                    alert('GitHub token is required for submission. Please try again.');
                    submitButton.disabled = false;
                    anonymousButton.disabled = false;
                    submitButton.textContent = 'Submit with Name';
                    return;
                }
                
                // Set repository details
                const owner = 'Applethings';
                const repo = 'statswebsitewright';
                
                // Hide the modal
                submissionModal.style.display = 'none';
                
                // Store submission in local storage for immediate access
                storeSubmission(submission);
                
                // Show processing message
                alert('Processing your submission...');
                
                // Directly update the test-results.html file with the submission
                const result = await updateTestResultsHTML(owner, repo, githubToken, submission);
                
                if (result.success) {
                    alert('Your submission has been successfully published to GitHub! You can view it on the Results page.');
                    localStorage.removeItem('statsAnswers');
                    
                    // Optionally redirect to the test results page
                    if (confirm('Would you like to view your submission on the results page?')) {
                        window.location.href = 'test-results.html';
                    }
                } else {
                    throw new Error(result.error || 'Failed to publish to GitHub');
                }
            } catch (error) {
                console.error('Error submitting test:', error);
                alert(`Error submitting test: ${error.message}`);
            } finally {
                // Reset the buttons
                submitButton.disabled = false;
                anonymousButton.disabled = false;
                submitButton.textContent = 'Submit with Name';
            }
        }
        
        // Function to store a submission in local storage
        function storeSubmission(submission) {
            const submissions = JSON.parse(localStorage.getItem('testSubmissions') || '[]');
            submissions.push(submission);
            localStorage.setItem('testSubmissions', JSON.stringify(submissions));
        }
        
        // Function to directly update the test-results.html file with the submission
        async function updateTestResultsHTML(owner, repo, token, submission) {
            try {
                const filePath = 'test-results.html';
                
                // First, fetch the current content of the file
                const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                        
                if (!getResponse.ok) {
                    throw new Error(`Failed to fetch ${filePath}: ${getResponse.status}`);
                }
                
                const fileData = await getResponse.json();
                const content = atob(fileData.content);
                const sha = fileData.sha;
                
                // Determine the subject based on the testId
                let subject = "AP Statistics";
                if (submission.testId.includes('stats')) {
                    subject = "AP Statistics";
                }
                
                // Determine if it's FRQ or MCQ
                const testType = submission.testType;
                
                // Format the submission data for display
                const submissionHTML = formatSubmissionHTML(submission);
                
                // Update the JavaScript data structure
                let updatedContent = updateJavaScriptData(content, subject, submission);
                
                // Update the display containers
                const subjectDivId = subject.toLowerCase().replace(/\s+/g, '-');
                
                // Find or create the container for this subject
                if (!updatedContent.includes(`id="${subjectDivId}"`)) {
                    // Subject doesn't exist yet, add it to the test categories
                    updatedContent = addSubjectCategory(updatedContent, subject, subjectDivId);
                } else {
                    // Update the counter for the subject
                    updatedContent = updateSubjectCounter(updatedContent, subject, subjectDivId, testType);
                }
                
                // Add the submission to the appropriate container
                const containerId = `submissions-${testType.toLowerCase()}-${subjectDivId}`;
                if (!updatedContent.includes(`id="${containerId}"`)) {
                    // Container doesn't exist, create it
                    updatedContent = addSubmissionContainer(updatedContent, containerId, submissionHTML, subject, testType);
                } else {
                    // Container exists, add to it
                    updatedContent = addToSubmissionContainer(updatedContent, containerId, submissionHTML);
                }
                
                // Update the file on GitHub
                const updateResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Add ${testType} submission from ${submission.name} for ${subject}`,
                        content: btoa(unescape(encodeURIComponent(updatedContent))),
                        sha: sha,
                        branch: 'main'
                    })
                });
                
                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    throw new Error(`Failed to update ${filePath}: ${updateResponse.status} - ${JSON.stringify(errorData)}`);
                }
                
                return { success: true };
            } catch (error) {
                console.error('Error updating test-results.html:', error);
                return { success: false, error: error.message };
            }
        }
        
        // Helper functions from the physics test
        function formatSubmissionHTML(submission) {
            const timestamp = new Date(submission.timestamp).toLocaleString();
            const name = submission.name;
            
            // Start with the submission header
            let html = `
                <div class="submission-item">
                    <div class="submission-header">
                        <span class="submission-name">${name}</span>
                        <span class="submission-date">${timestamp}</span>
                    </div>
                    <div class="submission-content">
            `;
            
            // Add each answer
            for (const [questionId, answer] of Object.entries(submission.answers)) {
                if (questionId !== 'canvas_data') {
                    html += `
                        <div class="answer-item">
                            <div class="answer-question">Question ${questionId}</div>
                            <div class="answer-text">${answer}</div>
                        </div>
                    `;
                }
            }
            
            // Close the submission
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }

        function updateJavaScriptData(content, subject, submission) {
            // This is a simplified version that just returns the content unchanged
            // In the full implementation, this would update a JavaScript data structure in the HTML
            return content;
        }

        function addSubjectCategory(content, subject, subjectDivId) {
            const categoryHTML = `
                <div class="test-category" id="${subjectDivId}" onclick="showTestTypes('${subject}')">
                    <h2>${subject}</h2>
                    <p>0 FRQ submissions, 0 MCQ submissions</p>
                </div>`;
                
            return content.replace('<div class="test-selection-container" id="testCategories">', 
                `<div class="test-selection-container" id="testCategories">\n                ${categoryHTML}`);
        }
        
        function updateSubjectCounter(content, subject, subjectDivId, testType) {
            const regex = new RegExp(`<div class="test-category" id="${subjectDivId}"[^>]*>[\\s\\S]*?<p>(\\d+) FRQ submissions, (\\d+) MCQ submissions</p>`);
            const match = content.match(regex);
            
            if (match) {
                let frqCount = parseInt(match[1]);
                let mcqCount = parseInt(match[2]);
                
                if (testType === 'FRQ') {
                    frqCount++;
                } else {
                    mcqCount++;
                }
                
                return content.replace(
                    `<p>${match[1]} FRQ submissions, ${match[2]} MCQ submissions</p>`,
                    `<p>${frqCount} FRQ submissions, ${mcqCount} MCQ submissions</p>`
                );
            }
            
            return content;
        }
        
        function addSubmissionContainer(content, containerId, submissionHTML, subject, testType) {
            const containerHTML = `
                <div id="${containerId}" class="submission-type-container">
                    <h3>${testType === 'FRQ' ? 'Free Response' : 'Multiple Choice'} Submissions</h3>
                    ${submissionHTML}
                </div>`;
                
            return content.replace('<div class="submissions-container" id="submissionsContainer">', 
                `<div class="submissions-container" id="submissionsContainer">\n                ${containerHTML}`);
        }
        
        function addToSubmissionContainer(content, containerId, submissionHTML) {
            const regex = new RegExp(`<div id="${containerId}" class="submission-type-container">[\\s\\S]*?<h3>[^<]*</h3>`);
            const match = content.match(regex);
            
            if (match) {
                return content.replace(
                    match[0],
                    `${match[0]}\n                    ${submissionHTML}`
                );
            }
            
            return content;
        }
        
        // Close modal when Escape key is pressed
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                submissionModal.style.display = 'none';
            }
        });
        
        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === submissionModal) {
                submissionModal.style.display = 'none';
            }
        });
    </script>
</body>
</html> 