<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Physics 1 2023 FRQ</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: url('images/bgg.gif') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .content {
            background-color: rgba(0, 0, 0, 0.6);
            padding: 40px;
            margin: 40px;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .navigation {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            background-color: rgba(0, 0, 32, 0.8);
            padding: 10px 20px;
            border-radius: 5px;
            backdrop-filter: blur(5px);
            z-index: 999;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .nav-button {
            background-color: rgba(0, 0, 128, 0.7);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .nav-button:hover {
            background-color: rgba(0, 0, 128, 0.9);
            transform: translateY(-2px);
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 0, 128, 0.6);
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .back-button:hover {
            background-color: rgba(0, 0, 128, 0.8);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
        }
        .page-number {
            color: white;
            margin: 0 20px;
            font-weight: bold;
        }
        .question-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
            border: 1px solid #000;
            border-radius: 5px;
        }
        .question-text {
            margin-bottom: 20px;
        }
        .sub-question {
            margin-top: 15px;
            margin-bottom: 15px;
        }
        .math {
            font-style: italic;
        }
        .data-table {
            margin: 20px 0;
            overflow-x: auto;
        }
        .data-table table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .data-table th, .data-table td {
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px;
            text-align: center;
        }
        .data-table th {
            background-color: rgba(0, 0, 128, 0.3);
        }
        .data-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .answer-space {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            min-height: 120px;
            margin: 15px 0;
            padding: 10px;
            width: 100%;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
        }
        .answer-space:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.4);
            background-color: rgba(255, 255, 255, 0.15);
        }
        .short-answer-space {
            min-height: 80px;
        }
        .long-answer-space {
            min-height: 150px;
        }
        .graph-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin: 20px 0;
        }
        .graph-box {
            flex: 1;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 5px;
            padding: 10px;
        }
        .graph-title {
            text-align: center;
            color: black;
            margin-bottom: 10px;
        }
        canvas {
            background-color: white;
            border: 1px solid #ccc;
            cursor: crosshair;
        }
        .graph-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        .graph-button {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .graph-button:hover {
            background-color: #444;
        }
        .grid-graph-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .grid-canvas {
            background-color: white;
            border: 1px solid #000;
        }
        .force-diagram-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .force-diagram {
            background-color: white;
            border: 1px solid #000;
        }
        .diagram-label {
            text-align: center;
            color: black;
            margin-top: 5px;
            font-size: 14px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            /* Flex properties for centering when displayed */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: rgba(0, 0, 32, 0.95);
            padding: 25px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .modal-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 15px;
        }
        .modal-button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: rgba(0, 0, 128, 0.7);
            color: white;
            transition: background-color 0.3s;
            font-size: 16px;
            flex: 1;
        }
        .modal-button:hover {
            background-color: rgba(0, 0, 128, 1);
        }
        #submitAnonymous {
            background-color: #555;
        }
        #submitAnonymous:hover {
            background-color: #777;
        }
        #submitWithName {
            background-color: #085;
        }
        #submitWithName:hover {
            background-color: #0a7;
        }
        #cancelSubmit {
            background-color: #900;
        }
        #cancelSubmit:hover {
            background-color: #b00;
        }
        .test-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .test-item {
            background-color: rgba(0, 0, 128, 0.3);
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .test-item:hover {
            background-color: rgba(0, 0, 128, 0.5);
        }
        .test-item h4 {
            margin: 0 0 10px 0;
        }
        .test-item p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê Back to Home</a>
    <div class="content test-container">
        <div class="page active" id="page1">
            <h1>AP Physics 1 2023 Free Response Questions</h1>
            <h2>Section II</h2>
            <h3>Time‚Äî1 hour and 30 minutes</h3>
            <p>No calculators allowed.</p>
            <p>Questions 1, 4, and 5 are short free-response questions that require about 13 minutes each to answer and are worth 7 points each. Questions 2 and 3 are long free-response questions that require about 25 minutes each to answer and are worth 12 points each. Show your work for each part in the space provided after that part.</p>
            <p>This section contains two long free-response questions and three short free-response questions.</p>
            <p>The questions are organized into pages. Use the navigation buttons at the bottom of the screen to move between pages.</p>
            <p>When you are ready to submit your answers, click the "Submit Test" button.</p>
            <p>For questions with multiple parts, make sure to answer all parts. All diagrams are not necessarily drawn to scale.</p>
            <p>Press the "Next" button below to begin the test.</p>
        </div>
        
        <div class="page" id="page2">
            <h2>Question 1 (7 points)</h2>
            <div class="question-text">
                <p>A cart on a horizontal surface is attached to a spring. The other end of the spring is attached to a wall. The cart is initially held at rest, as shown in Figure 1. When the cart is released, the system consisting of the cart and spring oscillates between the positions <span class="math">x = +L</span> and <span class="math">x = -L</span>. Figure 2 shows the kinetic energy of the cart-spring system as a function of the system's potential energy. Frictional forces are negligible.</p>
            </div>
            <img src="images/image1.png" alt="Physics problem diagram" class="question-image">
            <div class="sub-question">
                <p>(a) On the graph of kinetic energy <span class="math">K</span> versus potential energy <span class="math">U</span> shown in Figure 2, the values for the <span class="math">x</span>-intercept and <span class="math">y</span>-intercept are the same. Briefly explain why this is true, using physics principles.</p>
                <textarea class="answer-space" data-id="answer_1a" placeholder="Enter your answer here..."></textarea>
            </div>
            <div class="sub-question">
                <p>(b) When the cart is at <span class="math">+L</span> and momentarily at rest, a block is dropped onto the cart, as shown in Figure 3. The block sticks to the cart, and the block-cart-spring system continues to oscillate between <span class="math">-L</span> and <span class="math">+L</span>. The masses of the cart and the block are <span class="math">m‚ÇÄ</span> and <span class="math">3m‚ÇÄ</span>, respectively. The frequency of oscillation before the block is dropped onto the cart is <span class="math">f‚ÇÅ</span>. The frequency of oscillation after the block is dropped onto the cart is <span class="math">f‚ÇÇ</span>. Calculate the numerical value of the ratio <span class="math">f‚ÇÇ/f‚ÇÅ</span>.</p>
                <textarea class="answer-space long-answer-space" data-id="answer_1b" placeholder="Enter your answer here..."></textarea>
            </div>
        </div>

        <div class="page" id="page3">
            <h2>Question 1 (continued)</h2>
            <div class="sub-question">
                <p>(c) The dashed line in Figure 4 shows the kinetic energy <span class="math">K</span> versus potential energy <span class="math">U</span> of the block-cart-spring system after the block is dropped onto the cart. This graph is identical to the graph shown in Figure 2 for the cart-spring system before the block is dropped onto the cart.</p>
                <p>i. Briefly explain why the two graphs must be the same, using physics principles.</p>
                <textarea class="answer-space" data-id="answer_1ci" placeholder="Enter your answer here..."></textarea>
                <p>ii. After the block is dropped onto the cart, consider a system that consists only of the cart and the spring. On Figure 4, sketch a solid line that shows the kinetic energy of the system that consists of the cart and the spring but not the block after the block is dropped onto the cart.</p>
                <textarea class="answer-space" data-id="answer_1cii" placeholder="Enter your answer here..."></textarea>
            </div>
        </div>

        <div class="page" id="page4">
            <h2>Question 2 (12 points)</h2>
            <div class="question-text">
                <p>Students conduct an experiment to determine the acceleration <span class="math">a</span> of a cart. The cart is released from rest at the top of the ramp at time <span class="math">t = 0</span> and moves down the ramp. The <span class="math">x</span>-axis is defined to be parallel to the ramp with its origin at the top, as shown in the figure. The students collect the data shown in the following table.</p>
            </div>
            <img src="images/image2.png" alt="Physics problem diagram" class="question-image">
            <div class="data-table">
                <table>
                    <tr>
                        <th>Position <span class="math">x</span> (m)</th>
                        <th>Time <span class="math">t</span> (s)</th>
                    </tr>
                    <tr><td>0.06</td><td>0.39</td></tr>
                    <tr><td>0.14</td><td>0.59</td></tr>
                    <tr><td>0.24</td><td>0.77</td></tr>
                    <tr><td>0.37</td><td>0.96</td></tr>
                    <tr><td>0.55</td><td>1.20</td></tr>
                </table>
            </div>
            <div class="sub-question">
                <p>(a)</p>
                <p>i. Indicate which quantities could be graphed to yield a straight line whose slope could be used to determine the acceleration <span class="math">a</span> of the cart. You may use the remaining columns in the table, as needed, to record any quantities (including units) that are not already in the table.</p>
                <textarea class="answer-space short-answer-space" data-id="answer_2ai" placeholder="Enter your answer here..."></textarea>
                <p>ii. On the following grid, plot the appropriate quantities to create a graph that can be used to determine the acceleration <span class="math">a</span> of the cart as it rolls down the ramp. Clearly scale and label all axes (including units), as appropriate. Draw a straight line that best represents the data.</p>
                <div class="grid-graph-container">
                    <canvas id="gridGraph" width="500" height="400" class="grid-canvas"></canvas>
                    <div class="graph-controls">
                        <button class="graph-button" onclick="clearGridCanvas()">Clear</button>
                        <button class="graph-button" onclick="undoGridStroke()">Undo</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page5">
            <h2>Question 2 (continued)</h2>
            <div class="sub-question">
                <p>iii. Using the line you drew in part (a)(ii), calculate an experimental value for the acceleration <span class="math">a</span> of the cart as it rolls down the ramp.</p>
                <textarea class="answer-space" data-id="answer_2aiii" placeholder="Enter your answer here..."></textarea>
            </div>
            <div class="sub-question">
                <p>(b) The students are asked to determine an experimental value for the acceleration due to gravity <span class="math">g<sub>exp</sub></span> using their data.</p>
                <p>i. What additional quantities do the students need to measure in order to calculate <span class="math">g<sub>exp</sub></span> from <span class="math">a</span>?</p>
                <textarea class="answer-space" data-id="answer_2bi" placeholder="Enter your answer here..."></textarea>
                <p>ii. Write an expression for the value of <span class="math">g<sub>exp</sub></span> in terms of <span class="math">a</span>.</p>
                <textarea class="answer-space short-answer-space" data-id="answer_2bii" placeholder="Enter your answer here..."></textarea>
            </div>
            <div class="sub-question">
                <p>(c) The students calculate the value of <span class="math">g<sub>exp</sub></span> to be significantly lower than the accepted value of 9.8 m/s¬≤.</p>
                <p>i. What is a physical reason, other than friction or air resistance, that could lead to a significant difference in the experimentally determined value of <span class="math">g<sub>exp</sub></span>?</p>
                <textarea class="answer-space" data-id="answer_2ci" placeholder="Enter your answer here..."></textarea>
            </div>
        </div>

        <div class="page" id="page6">
            <h2>Question 2 (continued)</h2>
            <div class="sub-question">
                <p>ii. Briefly explain how the physical reason you identified in part (c)(i) would lead to the decrease in the experimentally determined value of <span class="math">g<sub>exp</sub></span>.</p>
                <textarea class="answer-space" data-id="answer_2cii" placeholder="Enter your answer here..."></textarea>
            </div>
            <div class="sub-question">
                <p>(d) The students want to confirm that the acceleration is the same whether the cart rolls up or down the ramp. The students start the cart at the bottom and give the cart a quick push so that it rolls up the ramp and momentarily comes to rest. The <span class="math">x</span>-axis is still defined to be parallel to the ramp with the origin at the top.</p>
                <p>On the following graphs, sketch the position <span class="math">x</span> and velocity <span class="math">v</span> as functions of time <span class="math">t</span> that correspond to the scenario shown while the cart moves up the ramp.</p>
                <div class="graph-container">
                    <div class="graph-box">
                        <div class="graph-title">Position vs. Time</div>
                        <canvas id="positionGraph" width="350" height="350"></canvas>
                        <div class="graph-controls">
                            <button class="graph-button" onclick="clearCanvas('positionGraph')">Clear</button>
                            <button class="graph-button" onclick="undoLastStroke('positionGraph')">Undo</button>
                        </div>
                    </div>
                    <div class="graph-box">
                        <div class="graph-title">Velocity vs. Time</div>
                        <canvas id="velocityGraph" width="350" height="350"></canvas>
                        <div class="graph-controls">
                            <button class="graph-button" onclick="clearCanvas('velocityGraph')">Clear</button>
                            <button class="graph-button" onclick="undoLastStroke('velocityGraph')">Undo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add this input field right before the navigation div -->
    <input type="hidden" id="name" name="name">
    <input type="hidden" id="student-name" name="student-name">

    <!-- Fixed navigation bar that will always be visible -->
    <div class="fixed-nav" style="position: fixed; bottom: 20px; left: 0; right: 0; display: flex; justify-content: center; z-index: 1000;">
        <div style="background-color: #1a237e; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 15px;">
            <button onclick="goToPrevPage()" id="prevBtnAlt" style="background-color: #3949ab; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">Previous</button>
            <span style="color: white; font-weight: bold;">Page <span id="currentPageAlt">1</span> of 6</span>
            <button onclick="goToNextPage()" id="nextBtnAlt" style="background-color: #3949ab; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold;">Next</button>
            <button onclick="openSubmissionModal()" id="submitBtnAlt" style="background-color: #00c853; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-left: 10px;">Submit Test</button>
        </div>
    </div>

    <div class="navigation">
        <button class="nav-button" id="prevBtn" onclick="goToPrevPage()">‚Üê</button>
        <span class="page-number">Page <span id="currentPage">1</span></span>
        <button class="nav-button" id="nextBtn" onclick="goToNextPage()">‚Üí</button>
        <button class="nav-button" id="submitBtn" style="background-color: #0a6; color: white; font-weight: bold; padding: 10px 25px; border-radius: 5px;" onclick="openSubmissionModal()">Submit Test</button>
    </div>

    <!-- Submission Modal -->
    <div id="submissionModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
        <div class="modal-content" style="background-color: #fff; color: #333; padding: 20px; border-radius: 8px; max-width: 400px; width: 90%;">
            <h3>Submit Your Test</h3>
            <p>Please enter your name or choose to submit anonymously:</p>
            <input type="text" id="submitterName" placeholder="Your Name" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
            <div class="modal-buttons" style="display: flex; justify-content: space-between; margin-top: 15px;">
                <button id="anonymousSubmit" class="modal-button" onclick="handleAnonymousSubmit()" style="background-color: #555; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Submit Anonymously</button>
                <button id="namedSubmit" class="modal-button" onclick="handleNamedSubmit()" style="background-color: #2980b9; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Submit with Name</button>
                <button id="closeModal" class="modal-button" onclick="closeSubmissionModal()" style="background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Add a secret admin verification token
        // This should be put at the top of your script section
        // The token is intentionally obfuscated to prevent easy discovery
        const ADMIN_VERIFICATION_TOKEN = atob("YXBwbGU="); // Base64 encoded "apple"
        
        // Initialize variables for page navigation
        let currentPageIndex = 1;
        const totalPages = 6;
        
        // Initialize canvas state holders
        const positionGraphCanvasState = [];
        const velocityGraphCanvasState = [];
        const gridGraphCanvasState = [];
        const forceDiagram1CanvasState = [];
        const forceDiagram2CanvasState = [];
        
        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM content loaded - initializing test page');
            
            // Initialize all canvas elements
            initCanvas('velocityGraph', velocityGraphCanvasState);
            initCanvas('positionGraph', positionGraphCanvasState);
            initGridGraph();
            
            // Initialize event listeners and navigation
            initializeEventListeners();
            
            // Initialize page
            updatePage();
            
            // Check URL parameters
            checkUrlParameters();
            
            console.log('Test page initialization complete');
        });

        // Page navigation functions
        function updatePage() {
            console.log(`Updating page to ${currentPageIndex}`);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show the current page
            const currentPage = document.getElementById(`page${currentPageIndex}`);
            if (currentPage) {
                currentPage.classList.add('active');
                console.log(`Page ${currentPageIndex} activated`);
            } else {
                console.error(`Could not find page element: page${currentPageIndex}`);
            }
            
            // Update the page number displays (both original and alternate)
            const pageNumberElement = document.getElementById('currentPage');
            if (pageNumberElement) {
                pageNumberElement.textContent = currentPageIndex;
            }
            
            // Also update the alternate page number display
            const pageNumberAltElement = document.getElementById('currentPageAlt');
            if (pageNumberAltElement) {
                pageNumberAltElement.textContent = currentPageIndex;
            }
            
            // Update button states for both nav bars
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const prevBtnAlt = document.getElementById('prevBtnAlt');
            const nextBtnAlt = document.getElementById('nextBtnAlt');
            
            // Update original buttons
            if (prevBtn) prevBtn.disabled = currentPageIndex === 1;
            if (nextBtn) nextBtn.disabled = currentPageIndex === totalPages;
            
            // Update alternate buttons
            if (prevBtnAlt) prevBtnAlt.disabled = currentPageIndex === 1;
            if (nextBtnAlt) nextBtnAlt.disabled = currentPageIndex === totalPages;
        }

        function goToNextPage() {
            console.log('Next button clicked');
            if (currentPageIndex < totalPages) {
                currentPageIndex++;
                updatePage();
            }
        }

        function goToPrevPage() {
            console.log('Previous button clicked');
            if (currentPageIndex > 1) {
                currentPageIndex--;
                updatePage();
            }
        }

        // Canvas functions
        function initCanvas(canvasId, stateHolder) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`Canvas not found: ${canvasId}`);
                return;
            }
            
            console.log(`Initializing canvas: ${canvasId}`);
            
            const ctx = canvas.getContext('2d');
            
            // Draw axes
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            
            // Draw x-axis
            ctx.beginPath();
            ctx.moveTo(50, canvas.height/2);
            ctx.lineTo(canvas.width - 20, canvas.height/2);
            ctx.stroke();
            
            // Draw y-axis
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 20);
            ctx.lineTo(50, 20);
            ctx.stroke();
            
            // Add arrows
            ctx.beginPath();
            ctx.moveTo(canvas.width - 20, canvas.height/2);
            ctx.lineTo(canvas.width - 30, canvas.height/2 - 10);
            ctx.lineTo(canvas.width - 30, canvas.height/2 + 10);
            ctx.fillStyle = '#000';
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(50, 20);
            ctx.lineTo(40, 30);
            ctx.lineTo(60, 30);
            ctx.fill();
            
            // Add labels
            ctx.font = '14px Arial';
            ctx.fillStyle = '#000';
            ctx.fillText('t', canvas.width - 20, canvas.height/2 + 20);
            ctx.fillText(canvasId.includes('position') ? 'x' : 'v', 30, 30);
            ctx.fillText('O', 35, canvas.height/2 + 15);
            
            // Initialize state holder if needed
            if (!window[`${canvasId}State`]) {
                window[`${canvasId}State`] = [];
            }
            
            // Save initial state
            window[`${canvasId}State`].push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getMousePos(canvas, e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getMousePos(canvas, e);
                
                ctx.beginPath();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                [lastX, lastY] = [currentX, currentY];
            }
            
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    window[`${canvasId}State`].push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                }
            }
        }

        function getMousePos(canvas, e) {
            const rect = canvas.getBoundingClientRect();
            return [
                e.clientX - rect.left,
                e.clientY - rect.top
            ];
        }

        function clearCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`Cannot clear canvas: ${canvasId} not found`);
                return;
            }
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Reset state holder
            window[`${canvasId}State`] = [];
            
            // Reinitialize the canvas
            initCanvas(canvasId);
            
            console.log(`Canvas ${canvasId} cleared`);
        }

        function undoLastStroke(canvasId) {
            const stateHolder = window[`${canvasId}State`];
            
            if (stateHolder && stateHolder.length > 1) {
                stateHolder.pop(); // Remove the last state
                
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error(`Cannot undo: Canvas ${canvasId} not found`);
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                ctx.putImageData(stateHolder[stateHolder.length - 1], 0, 0);
                console.log(`Undid last stroke on canvas ${canvasId}`);
            } else {
                console.log(`Nothing to undo on canvas ${canvasId}`);
            }
        }

        // Grid Graph Functions
        function initGridGraph() {
            const canvas = document.getElementById('gridGraph');
            if (!canvas) {
                console.error('Grid graph canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Draw grid
            ctx.strokeStyle = '#ccc';
            ctx.lineWidth = 0.5;
            
            // Draw vertical grid lines
            const gridSize = 20;
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // Draw horizontal grid lines
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw darker lines every 5 grid cells
            ctx.strokeStyle = '#999';
            ctx.lineWidth = 1;
            for (let x = 0; x <= canvas.width; x += gridSize * 5) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            for (let y = 0; y <= canvas.height; y += gridSize * 5) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            
            // Draw x and y axes
            ctx.beginPath();
            ctx.moveTo(40, canvas.height - 40);
            ctx.lineTo(canvas.width - 40, canvas.height - 40); // x-axis
            ctx.moveTo(40, canvas.height - 40);
            ctx.lineTo(40, 40); // y-axis
            ctx.stroke();
            
            // Add arrows
            ctx.beginPath();
            ctx.moveTo(canvas.width - 40, canvas.height - 40);
            ctx.lineTo(canvas.width - 50, canvas.height - 45);
            ctx.lineTo(canvas.width - 50, canvas.height - 35);
            ctx.fillStyle = '#000';
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(40, 40);
            ctx.lineTo(35, 50);
            ctx.lineTo(45, 50);
            ctx.fill();
            
            // Save initial state
            gridGraphCanvasState.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getMousePos(canvas, e);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getMousePos(canvas, e);
                
                ctx.beginPath();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                [lastX, lastY] = [currentX, currentY];
            }
            
            function stopDrawing() {
                if (isDrawing) {
                    isDrawing = false;
                    gridGraphCanvasState.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                }
            }
        }

        function clearGridCanvas() {
            const canvas = document.getElementById('gridGraph');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            gridGraphCanvasState.length = 0;
            initGridGraph();
        }

        function undoGridStroke() {
            if (gridGraphCanvasState.length > 1) {
                gridGraphCanvasState.pop();
                const canvas = document.getElementById('gridGraph');
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                ctx.putImageData(gridGraphCanvasState[gridGraphCanvasState.length - 1], 0, 0);
            }
        }

        // Submission modal functions
        function openSubmissionModal() {
            const modal = document.getElementById('submissionModal');
            if (modal) {
                modal.style.display = 'flex';
                console.log('Modal opened');
            }
        }

        function closeSubmissionModal() {
            const modal = document.getElementById('submissionModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Modal closed');
            }
        }

        function handleAnonymousSubmit() {
            document.getElementById('submitterName').value = "Anonymous";
            document.getElementById('name').value = "Anonymous";
            document.getElementById('student-name').value = "Anonymous";
            closeSubmissionModal();
            submitTest();
            console.log('Anonymous submission triggered');
        }

        function handleNamedSubmit() {
            const submitterName = document.getElementById('submitterName');
            const nameValue = submitterName.value.trim();
            if (!nameValue) {
                alert('Please enter your name or choose to submit anonymously.');
                return;
            }
            document.getElementById('name').value = nameValue;
            document.getElementById('student-name').value = nameValue;
            closeSubmissionModal();
            submitTest();
            console.log('Named submission triggered with: ' + nameValue);
        }

        // Function to check URL parameters
        function checkUrlParameters() {
            // Check if the URL contains a publish parameter
            const urlParams = new URLSearchParams(window.location.search);
            const publishKey = urlParams.get('publish');
            
            if (publishKey) {
                console.log("Found publish key in URL:", publishKey);
                
                // Remove the publish parameter from the URL to prevent modal from showing again on refresh
                const newUrl = window.location.pathname + window.location.search.replace(/[?&]publish=[^&]+/, '');
                window.history.replaceState({}, document.title, newUrl);
                
                // Show the publish modal with a slight delay to ensure the page is fully loaded
                setTimeout(() => {
                    // Check if the submission exists in sessionStorage
                    const submission = sessionStorage.getItem(`submission_${publishKey}`);
                    if (submission) {
                        alert("This submission is ready for approval. Please review it on admin-approve.html page.");
                    } else {
                        alert("Submission not found or has expired.");
                    }
                }, 500);
            }
        }

        // Collect answers from form fields and canvases
        function collectAnswers() {
            console.log("Collecting answers...");
            
            // Collect text answers
            const answers = {};
            const textAnswers = document.querySelectorAll('.answer-space');
            textAnswers.forEach(el => {
                const id = el.id || el.getAttribute('data-id');
                if (id) {
                    answers[id] = el.value || el.innerText || '';
                    console.log(`Collected text answer for ${id}: ${answers[id].substring(0, 30)}${answers[id].length > 30 ? '...' : ''}`);
                }
            });
            
            // Helper function to get canvas image
            function getCanvasImage(canvasId) {
                try {
                    const canvas = document.getElementById(canvasId);
                    if (!canvas) {
                        console.warn(`Canvas ${canvasId} not found`);
                        return null;
                    }
                    
                    console.log(`Getting image from canvas ${canvasId}, dimensions: ${canvas.width}x${canvas.height}`);
                    return canvas.toDataURL('image/png', 1.0);
                } catch (error) {
                    console.error(`Error getting image from canvas ${canvasId}:`, error);
                    return null;
                }
            }
            
            // Collect canvas drawings
            const canvasIds = ['positionGraph', 'velocityGraph', 'gridGraph'];
            const canvasData = {};
            let canvasCount = 0;
            
            canvasIds.forEach(id => {
                try {
                    console.log(`Processing canvas ${id}...`);
                    const imageData = getCanvasImage(id);
                    
                    if (imageData) {
                        canvasData[id] = imageData;
                        canvasCount++;
                        console.log(`Successfully collected drawing from ${id}, data length: ${imageData.length} chars`);
                    } else {
                        console.warn(`No drawing data found for ${id}`);
                    }
                } catch (error) {
                    console.error(`Error processing canvas ${id}:`, error);
                }
            });
            
            // Add canvas data to answers object
            answers.canvas_data = canvasData;
            console.log(`Total canvas drawings collected: ${canvasCount}`);
            
            return answers;
        }

        // Send submission to Discord webhook
        async function sendToDiscord(submission, publishKey) {
            const webhookUrl = 'https://discord.com/api/webhooks/1358211714021064734/xSnw0fEHm8pdGauYYtR3Y--tqXTzfTd5TUWj53LmVFgeasutHkvJuoeVDrTuLB_htkZa';
            
            if (!webhookUrl) {
                console.warn("Discord webhook URL not provided");
                return;
            }
            
            try {
                // Create a message for Discord with the text answers
                const discordMessage = {
                    content: `New ${submission.testType} submission from ${submission.name}!`,
                    embeds: [{
                        title: `${submission.testType} Submission`,
                        description: `Submitted by: ${submission.name}\nTime: ${new Date(submission.timestamp).toLocaleString()}`,
                        color: 5793266, // Blue color
                        fields: []
                    }]
                };
                
                // Add text answers to fields
                Object.entries(submission.answers)
                    .filter(([key]) => key !== 'canvas_data')
                    .forEach(([key, value]) => {
                        discordMessage.embeds[0].fields.push({
                            name: `Question ${key.replace('answer_', '')}`,
                            value: value || "(No answer provided)",
                            inline: false
                        });
                    });
                
                // Send the submission to Discord
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(discordMessage)
                });
                
                if (!response.ok) {
                    throw new Error(`Discord API error: ${response.status}`);
                }
                
                console.log("Submission sent to Discord successfully!");
                
                // Send a follow-up message about drawings and approval
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const publishMessage = {
                    embeds: [{
                        title: "üîê Approval Required",
                        description: `**Submission from ${submission.name} requires approval**\n\nThis submission includes ${submission.answers.canvas_data ? Object.keys(submission.answers.canvas_data).length : 0} drawing(s).\n\nUse the buttons below to approve or reject this submission, or manually approve with this link:\n[Manual Approval Link](${window.location.origin}/admin-approve.html?key=${publishKey}&token=${ADMIN_VERIFICATION_TOKEN})`,
                        color: 16750848, // Orange color for pending approval
                        fields: [
                            {
                                name: "Student",
                                value: submission.name,
                                inline: true
                            },
                            {
                                name: "Test Type",
                                value: submission.testType,
                                inline: true
                            },
                            {
                                name: "Submitted",
                                value: new Date(submission.timestamp).toLocaleString(),
                                inline: true
                            },
                            {
                                name: "Admin Verification",
                                value: `||${ADMIN_VERIFICATION_TOKEN}||`, // Discord spoiler format to hide token
                                inline: false
                            }
                        ]
                    }],
                    components: [
                        {
                            type: 1,
                            components: [
                                {
                                    type: 2,
                                    style: 3, // Success/Green button
                                    label: "Approve & Publish",
                                    custom_id: `approve_${publishKey}`
                                },
                                {
                                    type: 2,
                                    style: 4, // Danger/Red button
                                    label: "Reject",
                                    custom_id: `reject_${publishKey}`
                                }
                            ]
                        }
                    ]
                };
                
                const publishResponse = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(publishMessage)
                });
                
                if (!publishResponse.ok) {
                    console.warn("Failed to send publish message to Discord:", publishResponse.status);
                }
                
                return true;
            } catch (error) {
                console.error("Error sending to Discord:", error);
                throw new Error("Failed to send submission to Discord: " + error.message);
            }
        }

        // Display success message after submission
        function showPublishUI(publishKey) {
            // Get references to container elements
            const testContainer = document.querySelector('.test-container');
            const publishContainer = document.createElement('div');
            
            publishContainer.className = 'publish-container';
            publishContainer.style.backgroundColor = '#f5f5f5';
            publishContainer.style.padding = '20px';
            publishContainer.style.borderRadius = '8px';
            publishContainer.style.marginTop = '20px';
            publishContainer.style.textAlign = 'center';
            publishContainer.style.color = '#000';
            
            // Create header
            const header = document.createElement('h2');
            header.textContent = 'Submission Sent for Approval';
            header.style.color = '#2c3e50';
            
            // Create message
            const message = document.createElement('p');
            message.innerHTML = `
                Your submission has been sent for approval.<br>
                An administrator will review your submission on Discord.<br>
                <strong>Thank you for your submission!</strong>
            `;
            message.style.fontSize = '16px';
            message.style.lineHeight = '1.6';
            message.style.marginBottom = '20px';
            
            // Add icon
            const icon = document.createElement('div');
            icon.innerHTML = '‚úÖ';
            icon.style.fontSize = '48px';
            icon.style.marginBottom = '20px';
            
            // Append elements
            publishContainer.appendChild(icon);
            publishContainer.appendChild(header);
            publishContainer.appendChild(message);
            
            // Handle different container options
            if (testContainer) {
                // Replace test container content with publish container
                testContainer.innerHTML = '';
                testContainer.appendChild(publishContainer);
            } else {
                // Try to find a content container or body as fallback
                const contentContainer = document.querySelector('.content') || document.body;
                contentContainer.appendChild(publishContainer);
            }
            
            // Disable submit buttons (try multiple possible IDs)
            const submitBtn = document.getElementById('submit-button') || document.getElementById('submitBtn');
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitted';
            }
            
            // Also disable any buttons with submit-related classes
            document.querySelectorAll('.submit-btn, .submit-button').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.toLowerCase().includes('submit')) {
                    btn.textContent = 'Submitted';
                }
            });
            
            return true;
        }

        async function submitTest() {
            // Get student name from either input field
            let name = document.getElementById("student-name")?.value?.trim() || 
                       document.getElementById("submitterName")?.value?.trim() || 
                       document.getElementById("name")?.value?.trim() || 
                       "Anonymous";
            
            try {
                console.log("Submitting test with name:", name);
                
                // Disable submit button to prevent multiple submissions
                const submitBtn = document.getElementById("submit-button") || document.getElementById("submitBtn");
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = "Submitting...";
                }
                
                // Collect answers from the DOM
                const answers = collectAnswers();
                
                // Create a submission object
                const submission = {
                    name: name,
                    testType: "AP Physics 1 FRQ",
                    testId: "physics1-" + new Date().toISOString().split('T')[0],
                    timestamp: new Date().toISOString(),
                    answers: answers
                };

                console.log("Preparing submission:", submission);
                
                // Generate a unique publish key
                const publishKey = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                
                // Store submission in sessionStorage for later approval
                sessionStorage.setItem(`submission_${publishKey}`, JSON.stringify(submission));
                
                console.log("Submission stored with key:", publishKey);
                
                // Send to Discord webhook
                await sendToDiscord(submission, publishKey);
                
                // Show success UI
                showPublishUI(publishKey);
                
            } catch (error) {
                console.error("Error submitting test:", error);
                alert("Failed to submit the test. Please try again.");
                
                // Re-enable submit button if there's an error
                const submitBtn = document.getElementById("submit-button") || document.getElementById("submitBtn");
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "Submit Test";
                }
            }
        }

        function initializeEventListeners() {
            console.log("Initializing event listeners");
            
            // Navigation button event listeners
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            // Alternate navigation buttons
            const prevBtnAlt = document.getElementById('prevBtnAlt');
            const nextBtnAlt = document.getElementById('nextBtnAlt');
            const submitBtnAlt = document.getElementById('submitBtnAlt');
            
            console.log("Navigation buttons:", 
                { prevBtn: !!prevBtn, nextBtn: !!nextBtn, submitBtn: !!submitBtn,
                  prevBtnAlt: !!prevBtnAlt, nextBtnAlt: !!nextBtnAlt, submitBtnAlt: !!submitBtnAlt });
            
            if (prevBtn) prevBtn.addEventListener('click', goToPrevPage);
            if (nextBtn) nextBtn.addEventListener('click', goToNextPage);
            if (submitBtn) submitBtn.addEventListener('click', openSubmissionModal);
            
            // Add event listeners to alternate buttons
            if (prevBtnAlt) prevBtnAlt.addEventListener('click', goToPrevPage);
            if (nextBtnAlt) nextBtnAlt.addEventListener('click', goToNextPage);
            if (submitBtnAlt) submitBtnAlt.addEventListener('click', openSubmissionModal);
            
            // Canvas buttons event listeners
            const positionClearBtn = document.querySelector('.graph-box:nth-child(1) .graph-button:nth-child(1)');
            const positionUndoBtn = document.querySelector('.graph-box:nth-child(1) .graph-button:nth-child(2)');
            const velocityClearBtn = document.querySelector('.graph-box:nth-child(2) .graph-button:nth-child(1)');
            const velocityUndoBtn = document.querySelector('.graph-box:nth-child(2) .graph-button:nth-child(2)');
            
            if (positionClearBtn) positionClearBtn.addEventListener('click', () => clearCanvas('positionGraph'));
            if (positionUndoBtn) positionUndoBtn.addEventListener('click', () => undoLastStroke('positionGraph'));
            if (velocityClearBtn) velocityClearBtn.addEventListener('click', () => clearCanvas('velocityGraph'));
            if (velocityUndoBtn) velocityUndoBtn.addEventListener('click', () => undoLastStroke('velocityGraph'));
            
            // Submission modal event listeners
            const anonymousSubmitBtn = document.getElementById('anonymousSubmit') || document.getElementById('submitAnonymous');
            const namedSubmitBtn = document.getElementById('namedSubmit') || document.getElementById('submitWithName');
            const closeModalBtn = document.getElementById('closeModal') || document.getElementById('cancelSubmit');
            
            if (anonymousSubmitBtn) anonymousSubmitBtn.addEventListener('click', handleAnonymousSubmit);
            if (namedSubmitBtn) namedSubmitBtn.addEventListener('click', handleNamedSubmit);
            if (closeModalBtn) closeModalBtn.addEventListener('click', closeSubmissionModal);
        }
    </script>
</body>
</html> 